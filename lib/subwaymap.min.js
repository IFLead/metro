!function(t){"use strict";function n(){function n(n,i,e,a,o){function s(n){var i=d[n];return t.isDefined(i)?i:{}}function l(){u.resolve(),n.disabledStations=t.isDefined(n.disabledStations)?n.disabledStations:[],t.forEach(r,function(i){var e=t.isDefined(n.enabledStations);d[i]={isActive:!1,isDisabled:e?-1==n.enabledStations.indexOf(i):-1!=n.disabledStations.indexOf(i)}})}var r,u,u=o.defer(),c=this,d={};r=e[0].querySelectorAll("[subway-station-name]"),r=[].map.call(r,function(t){return t.attributes["subway-station-name"].nodeValue}),l(),c.onSelectStation=function(t,i){n.onSelect(t,i)},c.findStation=s}function i(t,n){n.css("position","relative")}return{restrict:"AE",replace:!1,transclude:!0,controller:n,controllerAs:"subwayMap",link:i,templateUrl:function(t,n){return n.mapUrl||"./metro.svg"},scope:{disabledStations:"=?",enabledStations:"=?",onSelect:"=?"}}}function i(){function t(t,n,i,e){function a(){l=i.subwayStationName,n.bind("click",s);var e=r.findStation(l);e&&(t.data=e,u&&u.registerStation(l,e),t.$watch("data.isDisabled",function(t){n.toggleClass("disabled",t)}))}function o(){for(var t,i,e,a=n.find("circle"),o=a.length-1;o>=0;o--)if(a.eq(o).hasClass("subway-point")){t=a[o],e=t.getBoundingClientRect();break}return i=window.document.body.getBoundingClientRect(),e?{top:e.top-i.top,left:e.left-i.left}:null}function s(){t.data.isDisabled||r.onSelectStation([l],o()),!t.data.isDisabled&&r.multiple&&(t.data.isActive=!t.data.isActive)}var l,r=e[1],u=e[0];a()}return{require:["?^subwayStationGroup","^subwayMap"],restrict:"A",link:t,scope:{}}}function e(){function n(t){t.stations={},t.main="",this.registerStation=function(n,i){t.stations[n]=i,t.main=n}}function i(n,i,e,a){function o(){var i=!0;return t.forEach(n.stations,function(t){t.isDisabled===!1&&(i=!1)}),i}n.$watch(o,function(t){i.toggleClass("disabled",t)}),i.find("text").bind("click",function(t){var i=[];if(!o()){for(var e in n.stations)e.isDisabled||i.push(e);var s=t.target.getBoundingClientRect(),l=window.document.body.getBoundingClientRect();a.onSelectStation(i,{top:s.top-l.top,left:s.left-l.left})}})}return{restrict:"A",link:i,require:"^subwayMap",controller:n,replace:!1,scope:{}}}t.module("dvhbSubwayMap",[]),t.module("dvhbSubwayMap").directive("subwayMap",n),t.module("dvhbSubwayMap").directive("subwayStationName",i),t.module("dvhbSubwayMap").directive("subwayStationGroup",e)}(angular);