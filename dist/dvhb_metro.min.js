angular.module("dvhbMetro",[]),function(t){"use strict";function e(e){function n(n,o,i){function a(){f.resolve(),t.forEach(c,function(t,e){d[t]=d[t]||{},d[t].isDisabled=n.stations?!s(n.stations,t):!0})}function s(e,n){return t.isArray(e)?-1!=e.indexOf(n):t.isObject(e)?t.isDefined(e[n]):!1}function r(){var t=$(o).find('[id^="s"]');t.each(function(){var t=$(this),e=t.find("circle:last"),n=t.find("text:last").text();t.attr("class","metro-station").attr("metro-station-name",n),e.attr("class",e.attr("class")+" metro-point")});var e=$(o).find('[id^="g"]');e.each(function(){var t=$(this);t.attr("class","metro-station").attr("metro-station-group","")})}function l(){e(o[0].querySelectorAll("svg"))(n)}var c,f=i.defer(),u=this,d={};n.metroInfo=null,r(),c=o[0].querySelectorAll("[metro-station-name]"),c=[].map.call(c,function(t){return t.attributes["metro-station-name"].nodeValue}),a(),u.setMetroInfo=function(t){n.metroInfo=t},u.onSelectStation=function(e,i){var a=o[0].getBoundingClientRect();i={left:i.left-a.left,top:i.top-a.top},(n.metroInfo&&n.metroInfo.show||t.noop)(i),(n.onSelect||t.noop)(e,i)},u.findStation=function(e){var n=d[e];return t.isDefined(n)?n:{}},n.$watch("stations",a,!0),l()}function o(e,n){var o="@import url('//fonts.googleapis.com/css?family=PT+Sans&subset=cyrillic');metro:after{content:\"\";display:block;padding-bottom:120%}metro svg{position:absolute;left:0;top:0;width:100%}g.metro-station{cursor:pointer}g.metro-station.disabled{cursor:initial}g.metro-station.selected text,g.metro-station.selected tspan{font-weight:700!important}g.metro-station.disabled text,g.metro-station.disabled tspan{fill:gray;cursor:initial}g.metro-station text.style1{font-family:'PT Sans','sans-serif';font-weight:400;font-style:normal;font-stretch:normal;font-variant:normal;font-size:20px}g.metro-station.disabled .metro-point{display:none}",i=document.createElement("style");i.id="dvhb_metro_style_inline",i.type="text/css",i.innerHTML=o,document.getElementsByTagName("head")[0].appendChild(i),n.on("click",function(n){n.originalEvent.data&&n.originalEvent.data.fromStation||(e.metroInfo&&e.metroInfo.hide||t.noop)()})}return n.$inject=["$scope","$element","$q"],{restrict:"AE",replace:!1,transclude:!0,controller:n,controllerAs:"metro",link:o,templateUrl:function(t,e){return e.mapUrl||"./metro.svg"},scope:{stations:"=?",onSelect:"=?"}}}t.module("dvhbMetro").directive("metro",e),e.$inject=["$compile"]}(angular),function(t){"use strict";function e(){function t(t,e,n,o){function i(){for(var t,n,o=e.find("circle"),i=o.length-1;i>=0;i--)if((" "+o[i].className.baseVal+" ").indexOf(" metro-point ")>-1){t=o[i],n=t.getBoundingClientRect();break}return n?{left:n.left,top:n.top}:null}function a(e){t.data.isDisabled||(e.originalEvent.data={fromStation:!0},l.onSelectStation([r],i())),!t.data.isDisabled&&l.multiple&&(t.data.isActive=!t.data.isActive)}function s(){r=n.metroStationName,e.bind("click",a);var o=l.findStation(r);o&&(t.data=o,c&&c.registerStation(r,o),t.$watch("data.isDisabled",function(t){var n=e[0],o=/disabled/.test(n.className.baseVal);!o&&t&&(n.className.baseVal=n.className.baseVal+" disabled"),o&&!t&&(n.className.baseVal=n.className.baseVal.split(" ").filter(function(t){return"disabled"!=t}).join(" "))}))}var r,l=o[1],c=o[0];s()}return{require:["?^metroStationGroup","^metro"],restrict:"A",link:t,scope:{}}}t.module("dvhbMetro").directive("metroStationName",e)}(angular),function(t){"use strict";function e(){function e(e,n,o,i){function a(e){return t.extend(e,f)}function s(t){var o=t.left,i=t.top;e.offset&&e.offset.left&&(o+=e.offset.left||0),e.offset&&e.offset.top&&(i+=e.offset.top||0),n.css("left",o+"px"),n.css("top",i+"px"),n.css("display","block")}function r(){n.css("display","none")}function l(){return"block"==n.css("display")}function c(){n.css("position","absolute"),r(),u.setMetroInfo(a({})),e.control&&a(e.control)}var f,u=i[0];f={show:s,hide:r,isOpen:l},c()}return{require:["^metro"],restrict:"A",link:e,scope:{control:"=?",offset:"=?"}}}t.module("dvhbMetro").directive("metroInfo",e)}(angular),function(t){"use strict";function e(){function e(t,e){t.stations={},t.main="",this.registerStation=function(e,n){t.stations[e]=n,t.main=e}}function n(e,n,o,i){function a(){var n=!0;return t.forEach(e.stations,function(t,e){t.isDisabled===!1&&(n=!1)}),n}e.$watch(a,function(t){var e=n[0],o=/disabled/.test(e.className.baseVal);!o&&t&&(e.className.baseVal=e.className.baseVal+" disabled"),o&&!t&&(e.className.baseVal=e.className.baseVal.split(" ").filter(function(t){return"disabled"!=t}).join(" "))}),n.find("text").bind("click",function(t){var n=[];if(!a()){for(var o in e.stations)o.isDisabled||n.push(o);t.originalEvent.data={fromStation:!0};var s=t.target.getBoundingClientRect();i.onSelectStation(n,s)}})}return e.$inject=["$scope","$element"],{restrict:"A",link:n,require:"^metro",controller:e,replace:!1,scope:{}}}t.module("dvhbMetro").directive("metroStationGroup",e)}(angular);