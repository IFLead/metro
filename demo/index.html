<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="angular.min.js"></script>
    <script src="subwaymap.min.js"></script>
    <link href='http://fonts.googleapis.com/css?family=PT+Sans' rel='stylesheet' type='text/css'>
    <style>
    body {
        font-family: monospace;
    }

    aside {
        float: left;
        width: 40%;
    }

    aside {
        background: white;
        width: 20%;
        min-height: 500px;
        height: 100%;
        float: left;
        padding: 5px 10px;
    }

    .info {
        color: #444;
    }

    .map {
        float: left;
        width: 75%;
    }

    subway-station-selector div {
        cursor: pointer;
    }

    subway-station-selector div.disabled {
        color: gray;
        cursor: initial;
    }
</style>
</head>
<body ng-app="App" ng-controller="MainCtrl">
    <div 
        class="map" 
        subway-map 
        selected-stations="selectedNames" 
        enabled-stations="enabledNames"
        on-select="showInfo"
        map-url="./metro.svg"
    >
    </div>
    <div 
        class="info-msg" 
        info-window pos="pos" 
        style="width: 200px; background-color: #fff; position: absolute; border: 1px solid black">
        <div style="text-align: center"><b>{{stationInfo.name}}</b></div>
        <ul>
            <li ng-repeat="point in stationInfo.points">
                {{point.name}}
                <p>{{point.info}}</p> 
            </li>
        </ul>
    </div>
    <script>
        angular
            .module('App', ['dvhbSubwayMap'])
            .directive('infoWindow', InfoWindow)
            .controller('MainCtrl', MainCtrl);

            function InfoWindow () {
                return {
                    restict: 'A',
                    scope: {
                        pos: '='
                    },
                    link: function (scope, element, attrs) {
                        scope.$watchCollection('pos', function (newVal) {
                            if (!newVal)
                                return;
                            element.css('left', newVal.left + 'px');
                            element.css('top', newVal.top + 30 + 'px');
                        })
                    }
                }
            }

            function MainCtrl ($scope) {

                $scope.pos = {};

                $scope.stationInfo = {};

                var pointsData = {
                    "Фили": [
                        {name: "ТЦ Атриум", info: "1ый этаж"},
                        {name: "ТЦ Атриум", info: "2ой этаж"}
                    ],
                    "Курская (Кольцевая)": [
                        {name: "ТЦ Атриум", info: "1ый этаж"}
                    ] 
                }

                $scope.showInfo = function (names, coords) {
                    if (!coords)
                        return;
                    $scope.pos.left = coords.left;
                    $scope.pos.top  = coords.top;
                    $scope.stationInfo.name = names[0];
                    $scope.stationInfo.points = pointsData[names[0]];
                };



                $scope.allStations = {
                    "Замоскворецкая": ["Речной вокзал", "Водный стадион", "Войковская", "Сокол", "Аэропорт", "Динамо", "Белорусская", "Тверская", "Театральная", "Новокузнецкая", "Павелецкая", "Автозаводская", "Технопарк", "Коломенская", "Каширская", "Кантемировская", "Царицыно", "Орехово", "Домодедовская", "Красногвардейская", "Алма-Атинская"],
                    "Таганско-Краснопресненская линия": ["Планерная", "Сходненская", "Тушинская", "Спартак", "Щукинская", "Октябрьское Поле", "Полежаевская", "Беговая", "Улица 1905 года", "Баррикандая", "Пушкинская", "Кузнецкий Мост", "Китай-город", "Таганская", "Пролетарская", "Волгоградский проспект", "Текстильщики", "Кузьминки", "Рязанский проспект", "Выхино", "Лермонтовский проспект", "Жулебино", "Котельники"],
                    "Арбатско-Покровская": ["Пятницкое шоссе", "Митино", "Волоколамская", "Мякинино", "Строгино", "Крылатское", "Молодёжная", "Кунцевская", "Славянский бульвар", "Парк Победы", "Киевская", "Смоленская", "Арбатская", "Площадь Революции", "Курская", "Бауманская", "Электрозаводская", "Семёновская", "Партизанская", "Измайловская", "Первомайская", "Щёлковская"],
                    "Филёвская": ["Пионерская", "Филёвский парк", "Багратионовская", "Фили", "Кутузовская", "Студенческая", "Выставочная", "Международная", "Киевская", "Смоленская", "Арбатская", "Александровский сад"],
                    "Сокольническая": ["Тропарёво", "Юго-Западная", "Проспект Вернадского", "Университет", "Воробьёвы горы", "Спортивная", "Фрунзенская", "Кропоткинская", "Библиотека им. Ленина", "Охотный Ряд", "Лубянка", "Чистые пруды", "Красные Ворота", "Комсомольская", "Красносельская", "Сокольники", "Преображенская площадь", "Черкизовская", "Бульвар Рокоссовского"],
                    "Кольцевая": ["Октябрьская", "Добрынинская", "Павелецкая", "Таганская", "Курская", "Комсомольская", "Проспект Мира", "Менделеевская", "Белорусская", "Краснопресненская"],
                    "Калужско-Рижская": ["Новоясеневская", "Ясенево", "Тёплый стан", "Коньково", "Беляево", "Калужская", "Новые Черёмушки", "Профсоюзная", "Академическая", "Ленинский проспект", "Шаболовская", "Октябрьская", "Третьяковская", "Китай-город", "Тургеневская", "Сухаревская", "Проспект Мира", "Рижская", "Алексеевская", "Ботанический сад", "Свиблово", "Бабушкинская", "Медведково"],
                    "Калининско-Солнцевская 1": ["Новокосино", "Новогиреево", "Перово", "Шоссе Энтузиастов", "Авиамоторная", "Площадь Ильича", "Марксистская", "Новокузнецкая"],
                    "Калининско-Солнцевская 2": ["Парк Победы", "Деловой центр"],
                    "Серпуховско-Тимерязевская": ["Алтуфьево", "Бибирево", "Отрадное", "Владыкино", "Петровско-Разумовская", "Тимирязевская", "Дмитровская", "Савёловская", "Менделеевская", "Трубная", "Чеховская", "Александровский сад", "Полянка", "Серпуховская", "Тульская", "Нагатинская", "Нагорная", "Нахимовский проспект", "Севастопольская", "Чертановская", "Южная", "Пражская", "Улица Академика Янгеля", "Аннино", "Бульвар Дмитрия Донского"],
                    "Люблинско-Дмитровская": ["Зябликово", "Шипиловская", "Борисово", "Марьино", "Братиславская", "Люблино", "Волжская", "Печатники", "Кожуховская", "Дубровка", "Крестьянская Застава", "Римская", "Чкаловская", "Сретенский бульвар", "Трубная", "Достоевская", "Марьина Роща"], 
                    "Каховская": ["Каховская", "Варшавская", "Каширская"],
                    "Бутовская": ["Бунинская аллея", "Улица Горчакова", "Бульвар Адмирала Ушакова", "Улица Скобелевская", "Улица Старокачаловская", "Лесопарковая", "Битцевский парк"]
                };

                $scope.selectedNames = [];

                $scope.disabledNames = [];

                $scope.enabledNames = ['Курская (Кольцевая)', 'Фили', 'Войковская', 'Спартак']

                $scope.toggle = function (name) {
                    var index = $scope.selectedNames.indexOf(name);

                    if (index > -1) {
                        $scope.selectedNames.splice(index, 1);
                    } else {
                        $scope.selectedNames.push(name);
                    }
                }

            }
  </script>
</body>
</html>